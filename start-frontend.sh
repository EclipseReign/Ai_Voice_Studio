#!/bin/bash

# ะกะบัะธะฟั ะดะปั ะทะฐะฟััะบะฐ Frontend

echo "๐ ะะฐะฟััะบ Frontend ะฟัะธะปะพะถะตะฝะธั..."
echo ""

# ะะตัะตะนัะธ ะฒ ะฟะฐะฟะบั frontend
cd "$(dirname "$0")/frontend" || exit

# ะัะพะฒะตัะบะฐ node_modules
if [ ! -d "node_modules" ]; then
    echo "โ ะะฐะฒะธัะธะผะพััะธ ะฝะต ัััะฐะฝะพะฒะปะตะฝั!"
    echo "ะฃััะฐะฝะพะฒะธัะต ะธั ะบะพะผะฐะฝะดะพะน: yarn install"
    exit 1
fi

# ะัะพะฒะตัะบะฐ .env ัะฐะนะปะฐ
if [ ! -f ".env" ]; then
    echo "โ๏ธ  ะคะฐะนะป .env ะฝะต ะฝะฐะนะดะตะฝ!"
    echo "ะกะพะทะดะฐะนัะต frontend/.env ัะพ ัะปะตะดัััะธะผ ัะพะดะตัะถะธะผัะผ:"
    echo ""
    echo "REACT_APP_BACKEND_URL=http://localhost:8001"
    echo ""
    exit 1
fi

# ะัะพะฒะตัะบะฐ ะดะพัััะฟะฝะพััะธ Backend
echo "๐ ะัะพะฒะตัะบะฐ Backend ัะตัะฒะตัะฐ..."
if ! curl -s http://localhost:8001/health > /dev/null 2>&1; then
    echo "โ๏ธ  Backend ัะตัะฒะตั ะฝะต ะพัะฒะตัะฐะตั ะฝะฐ http://localhost:8001"
    echo "ะฃะฑะตะดะธัะตัั ััะพ Backend ะทะฐะฟััะตะฝ (./start-backend.sh)"
    echo ""
    read -p "ะัะพะดะพะปะถะธัั ะฑะตะท ะฟัะพะฒะตัะบะธ Backend? (y/n) " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

echo "โ ะัะต ะฟัะพะฒะตัะบะธ ะฟัะพะนะดะตะฝั!"
echo ""
echo "๐ Frontend ะฑัะดะตั ะดะพัััะฟะตะฝ ะฝะฐ: http://localhost:3000"
echo "๐ฑ ะัะฐัะทะตั ะพัะบัะพะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ"
echo ""
echo "ะะฐะถะผะธัะต Ctrl+C ะดะปั ะพััะฐะฝะพะฒะบะธ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั
yarn start
